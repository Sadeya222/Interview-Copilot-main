{"ast":null,"code":"import \"core-js/modules/web.dom-exception.stack.js\";\n// Copyright (c) Microsoft Corporation. All rights reserved.\n// Licensed under the MIT license.\nimport { AvatarEventArgs, PropertyId } from \"../sdk/Exports.js\";\nimport { SynthesisAdapterBase } from \"./Exports.js\";\nexport class AvatarSynthesisAdapter extends SynthesisAdapterBase {\n  constructor(authentication, connectionFactory, synthesizerConfig, avatarSynthesizer, avatarConfig) {\n    super(authentication, connectionFactory, synthesizerConfig, undefined);\n    this.privAvatarSynthesizer = avatarSynthesizer;\n    this.privSynthesizer = avatarSynthesizer;\n    this.privAvatarConfig = avatarConfig;\n  }\n  setSynthesisContextSynthesisSection() {\n    this.privSynthesisContext.setSynthesisSection(undefined);\n  }\n  setSpeechConfigSynthesisSection() {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r;\n    this.privSynthesizerConfig.synthesisVideoSection = {\n      format: {\n        bitrate: (_a = this.privAvatarConfig.videoFormat) === null || _a === void 0 ? void 0 : _a.bitrate,\n        codec: (_b = this.privAvatarConfig.videoFormat) === null || _b === void 0 ? void 0 : _b.codec,\n        crop: {\n          bottomRight: {\n            x: (_e = (_d = (_c = this.privAvatarConfig.videoFormat) === null || _c === void 0 ? void 0 : _c.cropRange) === null || _d === void 0 ? void 0 : _d.bottomRight) === null || _e === void 0 ? void 0 : _e.x,\n            y: (_h = (_g = (_f = this.privAvatarConfig.videoFormat) === null || _f === void 0 ? void 0 : _f.cropRange) === null || _g === void 0 ? void 0 : _g.bottomRight) === null || _h === void 0 ? void 0 : _h.y\n          },\n          topLeft: {\n            x: (_l = (_k = (_j = this.privAvatarConfig.videoFormat) === null || _j === void 0 ? void 0 : _j.cropRange) === null || _k === void 0 ? void 0 : _k.topLeft) === null || _l === void 0 ? void 0 : _l.x,\n            y: (_p = (_o = (_m = this.privAvatarConfig.videoFormat) === null || _m === void 0 ? void 0 : _m.cropRange) === null || _o === void 0 ? void 0 : _o.topLeft) === null || _p === void 0 ? void 0 : _p.y\n          }\n        },\n        resolution: {\n          height: (_q = this.privAvatarConfig.videoFormat) === null || _q === void 0 ? void 0 : _q.height,\n          width: (_r = this.privAvatarConfig.videoFormat) === null || _r === void 0 ? void 0 : _r.width\n        }\n      },\n      protocol: {\n        name: \"WebRTC\",\n        webrtcConfig: {\n          clientDescription: btoa(this.privSynthesizerConfig.parameters.getProperty(PropertyId.TalkingAvatarService_WebRTC_SDP)),\n          iceServers: this.privAvatarSynthesizer.iceServers\n        }\n      },\n      talkingAvatar: {\n        background: {\n          color: this.privAvatarConfig.backgroundColor\n        },\n        character: this.privAvatarConfig.character,\n        customized: this.privAvatarConfig.customized,\n        style: this.privAvatarConfig.style\n      }\n    };\n  }\n  onAvatarEvent(metadata) {\n    if (!!this.privAvatarSynthesizer.avatarEventReceived) {\n      const avatarEventArgs = new AvatarEventArgs(metadata.Data.Offset, metadata.Data.Name);\n      try {\n        this.privAvatarSynthesizer.avatarEventReceived(this.privAvatarSynthesizer, avatarEventArgs);\n      } catch (error) {\n        // Not going to let errors in the event handler\n        // trip things up.\n      }\n    }\n  }\n}","map":{"version":3,"names":["AvatarEventArgs","PropertyId","SynthesisAdapterBase","AvatarSynthesisAdapter","constructor","authentication","connectionFactory","synthesizerConfig","avatarSynthesizer","avatarConfig","undefined","privAvatarSynthesizer","privSynthesizer","privAvatarConfig","setSynthesisContextSynthesisSection","privSynthesisContext","setSynthesisSection","setSpeechConfigSynthesisSection","privSynthesizerConfig","synthesisVideoSection","format","bitrate","_a","videoFormat","codec","_b","crop","bottomRight","x","_e","_d","_c","cropRange","y","_h","_g","_f","topLeft","_l","_k","_j","_p","_o","_m","resolution","height","_q","width","_r","protocol","name","webrtcConfig","clientDescription","btoa","parameters","getProperty","TalkingAvatarService_WebRTC_SDP","iceServers","talkingAvatar","background","color","backgroundColor","character","customized","style","onAvatarEvent","metadata","avatarEventReceived","avatarEventArgs","Data","Offset","Name","error"],"sources":["src/common.speech/AvatarSynthesisAdapter.ts"],"sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    AvatarConfig,\r\n    AvatarEventArgs,\r\n    AvatarSynthesizer,\r\n    PropertyId,\r\n    Synthesizer,\r\n} from \"../sdk/Exports.js\";\r\nimport {\r\n    ISynthesisConnectionFactory,\r\n    ISynthesisMetadata,\r\n    ISynthesisSectionVideo,\r\n    SynthesisAdapterBase,\r\n    SynthesizerConfig\r\n} from \"./Exports.js\";\r\nimport { IAuthentication } from \"./IAuthentication.js\";\r\n\r\nexport class AvatarSynthesisAdapter extends SynthesisAdapterBase {\r\n    private readonly privAvatarSynthesizer: AvatarSynthesizer;\r\n    private readonly privAvatarConfig: AvatarConfig;\r\n\r\n    public constructor(\r\n        authentication: IAuthentication,\r\n        connectionFactory: ISynthesisConnectionFactory,\r\n        synthesizerConfig: SynthesizerConfig,\r\n        avatarSynthesizer: AvatarSynthesizer,\r\n        avatarConfig: AvatarConfig,\r\n        ) {\r\n\r\n        super(authentication, connectionFactory,\r\n            synthesizerConfig, undefined);\r\n        this.privAvatarSynthesizer = avatarSynthesizer;\r\n        this.privSynthesizer = avatarSynthesizer as Synthesizer;\r\n        this.privAvatarConfig = avatarConfig;\r\n    }\r\n\r\n    protected setSynthesisContextSynthesisSection(): void {\r\n        this.privSynthesisContext.setSynthesisSection(undefined);\r\n    }\r\n\r\n    protected setSpeechConfigSynthesisSection(): void {\r\n        this.privSynthesizerConfig.synthesisVideoSection = {\r\n            format: {\r\n                bitrate: this.privAvatarConfig.videoFormat?.bitrate,\r\n                codec: this.privAvatarConfig.videoFormat?.codec,\r\n                crop: {\r\n                    bottomRight: {\r\n                        x: this.privAvatarConfig.videoFormat?.cropRange?.bottomRight?.x,\r\n                        y: this.privAvatarConfig.videoFormat?.cropRange?.bottomRight?.y,\r\n                    },\r\n                    topLeft: {\r\n                        x: this.privAvatarConfig.videoFormat?.cropRange?.topLeft?.x,\r\n                        y: this.privAvatarConfig.videoFormat?.cropRange?.topLeft?.y,\r\n                    },\r\n                },\r\n                resolution: {\r\n                    height: this.privAvatarConfig.videoFormat?.height,\r\n                    width: this.privAvatarConfig.videoFormat?.width,\r\n                },\r\n            },\r\n            protocol: {\r\n                name: \"WebRTC\",\r\n                webrtcConfig: {\r\n                    clientDescription: btoa(this.privSynthesizerConfig.parameters.getProperty(PropertyId.TalkingAvatarService_WebRTC_SDP)),\r\n                    iceServers: this.privAvatarSynthesizer.iceServers,\r\n                },\r\n            },\r\n            talkingAvatar: {\r\n                background: {\r\n                    color: this.privAvatarConfig.backgroundColor,\r\n                },\r\n                character: this.privAvatarConfig.character,\r\n                customized: this.privAvatarConfig.customized,\r\n                style: this.privAvatarConfig.style,\r\n            }\r\n        } as ISynthesisSectionVideo;\r\n    }\r\n\r\n\r\n    protected onAvatarEvent(metadata: ISynthesisMetadata): void {\r\n        if (!!this.privAvatarSynthesizer.avatarEventReceived) {\r\n            const avatarEventArgs: AvatarEventArgs = new AvatarEventArgs(\r\n                metadata.Data.Offset,\r\n                metadata.Data.Name);\r\n            try {\r\n                this.privAvatarSynthesizer.avatarEventReceived(this.privAvatarSynthesizer, avatarEventArgs);\r\n            } catch (error) {\r\n                // Not going to let errors in the event handler\r\n                // trip things up.\r\n            }\r\n        }\r\n    }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}