{"ast":null,"code":"import \"core-js/modules/es.typed-array.to-reversed.js\";\nimport \"core-js/modules/es.typed-array.to-sorted.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\n// Copyright (c) Microsoft Corporation. All rights reserved.\n// Licensed under the MIT license.\nimport * as fs from \"fs\";\nimport { Contracts } from \"../Contracts.js\";\nexport class AudioFileWriter {\n  constructor(filename) {\n    Contracts.throwIfNullOrUndefined(fs.openSync, \"\\nFile System access not available, please use Push or PullAudioOutputStream\");\n    this.privFd = fs.openSync(filename, \"w\");\n  }\n  set format(format) {\n    Contracts.throwIfNotUndefined(this.privAudioFormat, \"format is already set\");\n    this.privAudioFormat = format;\n    let headerOffset = 0;\n    if (this.privAudioFormat.hasHeader) {\n      headerOffset = this.privAudioFormat.header.byteLength;\n    }\n    if (this.privFd !== undefined) {\n      this.privWriteStream = fs.createWriteStream(\"\", {\n        fd: this.privFd,\n        start: headerOffset,\n        autoClose: false\n      });\n    }\n  }\n  write(buffer) {\n    Contracts.throwIfNullOrUndefined(this.privAudioFormat, \"must set format before writing.\");\n    if (this.privWriteStream !== undefined) {\n      this.privWriteStream.write(new Uint8Array(buffer.slice(0)));\n    }\n  }\n  close() {\n    if (this.privFd !== undefined) {\n      this.privWriteStream.on(\"finish\", () => {\n        if (this.privAudioFormat.hasHeader) {\n          this.privAudioFormat.updateHeader(this.privWriteStream.bytesWritten);\n          fs.writeSync(this.privFd, new Int8Array(this.privAudioFormat.header), 0, this.privAudioFormat.header.byteLength, 0);\n        }\n        fs.closeSync(this.privFd);\n        this.privFd = undefined;\n      });\n      this.privWriteStream.end();\n    }\n  }\n  id() {\n    return this.privId;\n  }\n}","map":{"version":3,"names":["fs","Contracts","AudioFileWriter","constructor","filename","throwIfNullOrUndefined","openSync","privFd","format","throwIfNotUndefined","privAudioFormat","headerOffset","hasHeader","header","byteLength","undefined","privWriteStream","createWriteStream","fd","start","autoClose","write","buffer","Uint8Array","slice","close","on","updateHeader","bytesWritten","writeSync","Int8Array","closeSync","end","id","privId"],"sources":["src/sdk/Audio/AudioFileWriter.ts"],"sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport * as fs from \"fs\";\r\nimport { IAudioDestination } from \"../../common/Exports.js\";\r\nimport { Contracts } from \"../Contracts.js\";\r\nimport { AudioStreamFormat } from \"../Exports.js\";\r\nimport { AudioOutputFormatImpl } from \"./AudioOutputFormat.js\";\r\n\r\nexport class AudioFileWriter implements IAudioDestination {\r\n    private privAudioFormat: AudioOutputFormatImpl;\r\n    private privFd: number;\r\n    private privId: string;\r\n    private privWriteStream: fs.WriteStream;\r\n\r\n    public constructor(filename: fs.PathLike) {\r\n        Contracts.throwIfNullOrUndefined(fs.openSync, \"\\nFile System access not available, please use Push or PullAudioOutputStream\");\r\n        this.privFd = fs.openSync(filename, \"w\");\r\n    }\r\n\r\n    public set format(format: AudioStreamFormat) {\r\n        Contracts.throwIfNotUndefined(this.privAudioFormat, \"format is already set\");\r\n        this.privAudioFormat = format as AudioOutputFormatImpl;\r\n        let headerOffset: number = 0;\r\n        if (this.privAudioFormat.hasHeader) {\r\n            headerOffset = this.privAudioFormat.header.byteLength;\r\n        }\r\n        if (this.privFd !== undefined) {\r\n            this.privWriteStream = fs.createWriteStream(\"\", {fd: this.privFd, start: headerOffset, autoClose: false});\r\n        }\r\n    }\r\n\r\n    public write(buffer: ArrayBuffer): void {\r\n        Contracts.throwIfNullOrUndefined(this.privAudioFormat, \"must set format before writing.\");\r\n        if (this.privWriteStream !== undefined) {\r\n            this.privWriteStream.write(new Uint8Array(buffer.slice(0)));\r\n        }\r\n    }\r\n\r\n    public close(): void {\r\n        if (this.privFd !== undefined) {\r\n            this.privWriteStream.on(\"finish\", (): void => {\r\n                if (this.privAudioFormat.hasHeader) {\r\n                    this.privAudioFormat.updateHeader(this.privWriteStream.bytesWritten);\r\n                    fs.writeSync(this.privFd,\r\n                        new Int8Array(this.privAudioFormat.header),\r\n                        0,\r\n                        this.privAudioFormat.header.byteLength,\r\n                        0);\r\n                }\r\n                fs.closeSync(this.privFd);\r\n                this.privFd = undefined;\r\n            });\r\n            this.privWriteStream.end();\r\n        }\r\n    }\r\n\r\n    public id(): string {\r\n        return this.privId;\r\n    }\r\n}\r\n"],"mappings":";;;AAAA;AACA;AAEA,OAAO,KAAKA,EAAE,MAAM,IAAI;AAExB,SAASC,SAAS,QAAQ,iBAAiB;AAI3C,OAAM,MAAOC,eAAe;EAMxBC,YAAmBC,QAAqB;IACpCH,SAAS,CAACI,sBAAsB,CAACL,EAAE,CAACM,QAAQ,EAAE,8EAA8E,CAAC;IAC7H,IAAI,CAACC,MAAM,GAAGP,EAAE,CAACM,QAAQ,CAACF,QAAQ,EAAE,GAAG,CAAC;EAC5C;EAEA,IAAWI,MAAMA,CAACA,MAAyB;IACvCP,SAAS,CAACQ,mBAAmB,CAAC,IAAI,CAACC,eAAe,EAAE,uBAAuB,CAAC;IAC5E,IAAI,CAACA,eAAe,GAAGF,MAA+B;IACtD,IAAIG,YAAY,GAAW,CAAC;IAC5B,IAAI,IAAI,CAACD,eAAe,CAACE,SAAS,EAAE;MAChCD,YAAY,GAAG,IAAI,CAACD,eAAe,CAACG,MAAM,CAACC,UAAU;;IAEzD,IAAI,IAAI,CAACP,MAAM,KAAKQ,SAAS,EAAE;MAC3B,IAAI,CAACC,eAAe,GAAGhB,EAAE,CAACiB,iBAAiB,CAAC,EAAE,EAAE;QAACC,EAAE,EAAE,IAAI,CAACX,MAAM;QAAEY,KAAK,EAAER,YAAY;QAAES,SAAS,EAAE;MAAK,CAAC,CAAC;;EAEjH;EAEOC,KAAKA,CAACC,MAAmB;IAC5BrB,SAAS,CAACI,sBAAsB,CAAC,IAAI,CAACK,eAAe,EAAE,iCAAiC,CAAC;IACzF,IAAI,IAAI,CAACM,eAAe,KAAKD,SAAS,EAAE;MACpC,IAAI,CAACC,eAAe,CAACK,KAAK,CAAC,IAAIE,UAAU,CAACD,MAAM,CAACE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;;EAEnE;EAEOC,KAAKA,CAAA;IACR,IAAI,IAAI,CAAClB,MAAM,KAAKQ,SAAS,EAAE;MAC3B,IAAI,CAACC,eAAe,CAACU,EAAE,CAAC,QAAQ,EAAE,MAAW;QACzC,IAAI,IAAI,CAAChB,eAAe,CAACE,SAAS,EAAE;UAChC,IAAI,CAACF,eAAe,CAACiB,YAAY,CAAC,IAAI,CAACX,eAAe,CAACY,YAAY,CAAC;UACpE5B,EAAE,CAAC6B,SAAS,CAAC,IAAI,CAACtB,MAAM,EACpB,IAAIuB,SAAS,CAAC,IAAI,CAACpB,eAAe,CAACG,MAAM,CAAC,EAC1C,CAAC,EACD,IAAI,CAACH,eAAe,CAACG,MAAM,CAACC,UAAU,EACtC,CAAC,CAAC;;QAEVd,EAAE,CAAC+B,SAAS,CAAC,IAAI,CAACxB,MAAM,CAAC;QACzB,IAAI,CAACA,MAAM,GAAGQ,SAAS;MAC3B,CAAC,CAAC;MACF,IAAI,CAACC,eAAe,CAACgB,GAAG,EAAE;;EAElC;EAEOC,EAAEA,CAAA;IACL,OAAO,IAAI,CAACC,MAAM;EACtB"},"metadata":{},"sourceType":"module","externalDependencies":[]}