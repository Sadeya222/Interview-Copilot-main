{"ast":null,"code":"// Copyright (c) Microsoft Corporation. All rights reserved.\n// Licensed under the MIT license.\nimport { PropertyId } from \"../sdk/Exports.js\";\n/**\n * Represents the JSON used in the synthesis.context message sent to the speech service.\n * The dynamic grammar is always refreshed from the encapsulated dynamic grammar object.\n */\nexport class SynthesisContext {\n  constructor() {\n    this.privContext = {};\n  }\n  /**\n   * Adds a section to the synthesis.context object.\n   * @param sectionName Name of the section to add.\n   * @param value JSON serializable object that represents the value.\n   */\n  setSection(sectionName, value) {\n    this.privContext[sectionName] = value;\n  }\n  /**\n   * Sets the audio output format for synthesis context generation.\n   * @param format {AudioOutputFormatImpl} the output format\n   */\n  set audioOutputFormat(format) {\n    this.privAudioOutputFormat = format;\n  }\n  toJSON() {\n    return JSON.stringify(this.privContext);\n  }\n  setSynthesisSection(speechSynthesizer) {\n    const synthesisSection = this.buildSynthesisContext(speechSynthesizer);\n    this.setSection(\"synthesis\", synthesisSection);\n  }\n  buildSynthesisContext(speechSynthesizer) {\n    return {\n      audio: {\n        metadataOptions: {\n          bookmarkEnabled: !!(speechSynthesizer === null || speechSynthesizer === void 0 ? void 0 : speechSynthesizer.bookmarkReached),\n          punctuationBoundaryEnabled: speechSynthesizer === null || speechSynthesizer === void 0 ? void 0 : speechSynthesizer.properties.getProperty(PropertyId.SpeechServiceResponse_RequestPunctuationBoundary, !!(speechSynthesizer === null || speechSynthesizer === void 0 ? void 0 : speechSynthesizer.wordBoundary)),\n          sentenceBoundaryEnabled: speechSynthesizer === null || speechSynthesizer === void 0 ? void 0 : speechSynthesizer.properties.getProperty(PropertyId.SpeechServiceResponse_RequestSentenceBoundary, false),\n          sessionEndEnabled: true,\n          visemeEnabled: !!(speechSynthesizer === null || speechSynthesizer === void 0 ? void 0 : speechSynthesizer.visemeReceived),\n          wordBoundaryEnabled: speechSynthesizer === null || speechSynthesizer === void 0 ? void 0 : speechSynthesizer.properties.getProperty(PropertyId.SpeechServiceResponse_RequestWordBoundary, !!(speechSynthesizer === null || speechSynthesizer === void 0 ? void 0 : speechSynthesizer.wordBoundary))\n        },\n        outputFormat: this.privAudioOutputFormat.requestAudioFormatString\n      },\n      language: {\n        autoDetection: speechSynthesizer === null || speechSynthesizer === void 0 ? void 0 : speechSynthesizer.autoDetectSourceLanguage\n      }\n    };\n  }\n}","map":{"version":3,"names":["PropertyId","SynthesisContext","constructor","privContext","setSection","sectionName","value","audioOutputFormat","format","privAudioOutputFormat","toJSON","JSON","stringify","setSynthesisSection","speechSynthesizer","synthesisSection","buildSynthesisContext","audio","metadataOptions","bookmarkEnabled","bookmarkReached","punctuationBoundaryEnabled","properties","getProperty","SpeechServiceResponse_RequestPunctuationBoundary","wordBoundary","sentenceBoundaryEnabled","SpeechServiceResponse_RequestSentenceBoundary","sessionEndEnabled","visemeEnabled","visemeReceived","wordBoundaryEnabled","SpeechServiceResponse_RequestWordBoundary","outputFormat","requestAudioFormatString","language","autoDetection","autoDetectSourceLanguage"],"sources":["src/common.speech/SynthesisContext.ts"],"sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { AudioOutputFormatImpl } from \"../sdk/Audio/AudioOutputFormat.js\";\r\nimport { PropertyId, SpeechSynthesizer } from \"../sdk/Exports.js\";\r\n\r\n/**\r\n * Represents the JSON used in the synthesis.context message sent to the speech service.\r\n * The dynamic grammar is always refreshed from the encapsulated dynamic grammar object.\r\n */\r\nexport class SynthesisContext {\r\n    private privContext: { [section: string]: any } = {};\r\n    private privAudioOutputFormat: AudioOutputFormatImpl;\r\n\r\n    /**\r\n     * Adds a section to the synthesis.context object.\r\n     * @param sectionName Name of the section to add.\r\n     * @param value JSON serializable object that represents the value.\r\n     */\r\n    public setSection(sectionName: string, value: string | object): void {\r\n        this.privContext[sectionName] = value;\r\n    }\r\n\r\n    /**\r\n     * Sets the audio output format for synthesis context generation.\r\n     * @param format {AudioOutputFormatImpl} the output format\r\n     */\r\n    public set audioOutputFormat(format: AudioOutputFormatImpl) {\r\n        this.privAudioOutputFormat = format;\r\n    }\r\n\r\n    public toJSON(): string {\r\n        return JSON.stringify(this.privContext);\r\n    }\r\n\r\n    public setSynthesisSection(speechSynthesizer: SpeechSynthesizer): void {\r\n        const synthesisSection: ISynthesisSection = this.buildSynthesisContext(speechSynthesizer);\r\n        this.setSection(\"synthesis\", synthesisSection);\r\n    }\r\n\r\n    private buildSynthesisContext(speechSynthesizer: SpeechSynthesizer): ISynthesisSection {\r\n        return {\r\n            audio: {\r\n                metadataOptions: {\r\n                    bookmarkEnabled: (!!speechSynthesizer?.bookmarkReached),\r\n                    punctuationBoundaryEnabled: speechSynthesizer?.properties.getProperty(\r\n                        PropertyId.SpeechServiceResponse_RequestPunctuationBoundary, (!!speechSynthesizer?.wordBoundary)),\r\n                    sentenceBoundaryEnabled: speechSynthesizer?.properties.getProperty(\r\n                        PropertyId.SpeechServiceResponse_RequestSentenceBoundary, false),\r\n                    sessionEndEnabled: true,\r\n                    visemeEnabled: (!!speechSynthesizer?.visemeReceived),\r\n                    wordBoundaryEnabled: speechSynthesizer?.properties.getProperty(\r\n                        PropertyId.SpeechServiceResponse_RequestWordBoundary, (!!speechSynthesizer?.wordBoundary)),\r\n                },\r\n                outputFormat: this.privAudioOutputFormat.requestAudioFormatString,\r\n            },\r\n            language: {\r\n                autoDetection: speechSynthesizer?.autoDetectSourceLanguage\r\n            }\r\n        } as ISynthesisSection;\r\n    }\r\n}\r\n\r\ninterface ISynthesisSection {\r\n    audio: {\r\n        outputFormat: string;\r\n        metadataOptions: {\r\n            bookmarkEnabled: boolean;\r\n            wordBoundaryEnabled: string;\r\n            punctuationBoundaryEnabled: string;\r\n            visemeEnabled: boolean;\r\n            sentenceBoundaryEnabled: string;\r\n            sessionEndEnabled: boolean;\r\n        };\r\n    };\r\n    language: {\r\n        autoDetection: boolean;\r\n    };\r\n}\r\n"],"mappings":"AAAA;AACA;AAGA,SAASA,UAAU,QAA2B,mBAAmB;AAEjE;;;;AAIA,OAAM,MAAOC,gBAAgB;EAA7BC,YAAA;IACY,KAAAC,WAAW,GAA+B,EAAE;EAkDxD;EA/CI;;;;;EAKOC,UAAUA,CAACC,WAAmB,EAAEC,KAAsB;IACzD,IAAI,CAACH,WAAW,CAACE,WAAW,CAAC,GAAGC,KAAK;EACzC;EAEA;;;;EAIA,IAAWC,iBAAiBA,CAACC,MAA6B;IACtD,IAAI,CAACC,qBAAqB,GAAGD,MAAM;EACvC;EAEOE,MAAMA,CAAA;IACT,OAAOC,IAAI,CAACC,SAAS,CAAC,IAAI,CAACT,WAAW,CAAC;EAC3C;EAEOU,mBAAmBA,CAACC,iBAAoC;IAC3D,MAAMC,gBAAgB,GAAsB,IAAI,CAACC,qBAAqB,CAACF,iBAAiB,CAAC;IACzF,IAAI,CAACV,UAAU,CAAC,WAAW,EAAEW,gBAAgB,CAAC;EAClD;EAEQC,qBAAqBA,CAACF,iBAAoC;IAC9D,OAAO;MACHG,KAAK,EAAE;QACHC,eAAe,EAAE;UACbC,eAAe,EAAG,CAAC,EAACL,iBAAiB,aAAjBA,iBAAiB,uBAAjBA,iBAAiB,CAAEM,eAAe,CAAC;UACvDC,0BAA0B,EAAEP,iBAAiB,aAAjBA,iBAAiB,uBAAjBA,iBAAiB,CAAEQ,UAAU,CAACC,WAAW,CACjEvB,UAAU,CAACwB,gDAAgD,EAAG,CAAC,EAACV,iBAAiB,aAAjBA,iBAAiB,uBAAjBA,iBAAiB,CAAEW,YAAY,CAAC,CAAC;UACrGC,uBAAuB,EAAEZ,iBAAiB,aAAjBA,iBAAiB,uBAAjBA,iBAAiB,CAAEQ,UAAU,CAACC,WAAW,CAC9DvB,UAAU,CAAC2B,6CAA6C,EAAE,KAAK,CAAC;UACpEC,iBAAiB,EAAE,IAAI;UACvBC,aAAa,EAAG,CAAC,EAACf,iBAAiB,aAAjBA,iBAAiB,uBAAjBA,iBAAiB,CAAEgB,cAAc,CAAC;UACpDC,mBAAmB,EAAEjB,iBAAiB,aAAjBA,iBAAiB,uBAAjBA,iBAAiB,CAAEQ,UAAU,CAACC,WAAW,CAC1DvB,UAAU,CAACgC,yCAAyC,EAAG,CAAC,EAAClB,iBAAiB,aAAjBA,iBAAiB,uBAAjBA,iBAAiB,CAAEW,YAAY,CAAC;SAChG;QACDQ,YAAY,EAAE,IAAI,CAACxB,qBAAqB,CAACyB;OAC5C;MACDC,QAAQ,EAAE;QACNC,aAAa,EAAEtB,iBAAiB,aAAjBA,iBAAiB,uBAAjBA,iBAAiB,CAAEuB;;KAEpB;EAC1B"},"metadata":{},"sourceType":"module","externalDependencies":[]}