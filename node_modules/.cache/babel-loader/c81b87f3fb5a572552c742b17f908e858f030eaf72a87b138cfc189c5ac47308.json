{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\n// Copyright (c) Microsoft Corporation. All rights reserved.\n// Licensed under the MIT license.\n/**\n * Represents the JSON used in the speech.context message sent to the speech service.\n * The dynamic grammar is always refreshed from the encapsulated dynamic grammar object.\n */\nexport class SpeechContext {\n  constructor(dynamicGrammar) {\n    this.privContext = {};\n    this.privDynamicGrammar = dynamicGrammar;\n  }\n  /**\n   * Gets a section of the speech.context object.\n   * @param sectionName Name of the section to get.\n   * @return string or Context JSON serializable object that represents the value.\n   */\n  getSection(sectionName) {\n    return this.privContext[sectionName] || {};\n  }\n  /**\n   * Adds a section to the speech.context object.\n   * @param sectionName Name of the section to add.\n   * @param value JSON serializable object that represents the value.\n   */\n  setSection(sectionName, value) {\n    this.privContext[sectionName] = value;\n  }\n  /**\n   * @Internal\n   * This is only used by pronunciation assessment config.\n   * Do not use externally, object returned will change without warning or notice.\n   */\n  setPronunciationAssessmentParams(params, contentAssessmentTopic, isSpeakerDiarizationEnabled = false) {\n    if (this.privContext.phraseDetection === undefined) {\n      this.privContext.phraseDetection = {\n        enrichment: {\n          pronunciationAssessment: {}\n        }\n      };\n    }\n    if (this.privContext.phraseDetection.enrichment === undefined) {\n      this.privContext.phraseDetection.enrichment = {\n        pronunciationAssessment: {}\n      };\n    }\n    this.privContext.phraseDetection.enrichment.pronunciationAssessment = JSON.parse(params);\n    if (isSpeakerDiarizationEnabled) {\n      this.privContext.phraseDetection.mode = \"Conversation\";\n    }\n    this.setWordLevelTimings();\n    this.privContext.phraseOutput.detailed.options.push(\"PronunciationAssessment\");\n    if (this.privContext.phraseOutput.detailed.options.indexOf(\"SNR\") === -1) {\n      this.privContext.phraseOutput.detailed.options.push(\"SNR\");\n    }\n    if (!!contentAssessmentTopic) {\n      this.privContext.phraseDetection.enrichment.contentAssessment = {\n        topic: contentAssessmentTopic\n      };\n      this.privContext.phraseOutput.detailed.options.push(\"ContentAssessment\");\n    }\n  }\n  setDetailedOutputFormat() {\n    if (this.privContext.phraseOutput === undefined) {\n      this.privContext.phraseOutput = {\n        detailed: {\n          options: []\n        },\n        format: {}\n      };\n    }\n    if (this.privContext.phraseOutput.detailed === undefined) {\n      this.privContext.phraseOutput.detailed = {\n        options: []\n      };\n    }\n    this.privContext.phraseOutput.format = \"Detailed\";\n  }\n  setWordLevelTimings() {\n    if (this.privContext.phraseOutput === undefined) {\n      this.privContext.phraseOutput = {\n        detailed: {\n          options: []\n        },\n        format: {}\n      };\n    }\n    if (this.privContext.phraseOutput.detailed === undefined) {\n      this.privContext.phraseOutput.detailed = {\n        options: []\n      };\n    }\n    this.privContext.phraseOutput.format = \"Detailed\";\n    if (this.privContext.phraseOutput.detailed.options.indexOf(\"WordTimings\") === -1) {\n      this.privContext.phraseOutput.detailed.options.push(\"WordTimings\");\n    }\n  }\n  setSpeakerDiarizationAudioOffsetMs(audioOffsetMs) {\n    this.privContext.phraseDetection.speakerDiarization.audioOffsetMs = audioOffsetMs;\n  }\n  toJSON() {\n    const dgi = this.privDynamicGrammar.generateGrammarObject();\n    this.setSection(\"dgi\", dgi);\n    const ret = JSON.stringify(this.privContext);\n    return ret;\n  }\n}","map":{"version":3,"names":["SpeechContext","constructor","dynamicGrammar","privContext","privDynamicGrammar","getSection","sectionName","setSection","value","setPronunciationAssessmentParams","params","contentAssessmentTopic","isSpeakerDiarizationEnabled","phraseDetection","undefined","enrichment","pronunciationAssessment","JSON","parse","mode","setWordLevelTimings","phraseOutput","detailed","options","push","indexOf","contentAssessment","topic","setDetailedOutputFormat","format","setSpeakerDiarizationAudioOffsetMs","audioOffsetMs","speakerDiarization","toJSON","dgi","generateGrammarObject","ret","stringify"],"sources":["src/common.speech/SpeechContext.ts"],"sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    DynamicGrammarBuilder,\r\n    IDynamicGrammar,\r\n} from \"./Exports.js\";\r\n\r\ninterface Context {\r\n    [section: string]: any;\r\n}\r\n\r\ninterface PhraseContext {\r\n    [section: string]: any;\r\n    phraseDetection?: {\r\n        enrichment?: {\r\n            pronunciationAssessment: any;\r\n            contentAssessment?: {\r\n                topic: string;\r\n            };\r\n        };\r\n        speakerDiarization?: {\r\n            mode?: string;\r\n            audioSessionId?: string;\r\n            audioOffsetMs?: number;\r\n            identityProvider?: string;\r\n        };\r\n        mode?: string;\r\n    };\r\n    phraseOutput?: {\r\n        detailed?: {\r\n            options?: string[];\r\n        };\r\n        format?: any;\r\n    };\r\n}\r\n\r\n/**\r\n * Represents the JSON used in the speech.context message sent to the speech service.\r\n * The dynamic grammar is always refreshed from the encapsulated dynamic grammar object.\r\n */\r\nexport class SpeechContext {\r\n    private privContext: PhraseContext = {};\r\n    private privDynamicGrammar: DynamicGrammarBuilder;\r\n\r\n    public constructor(dynamicGrammar: DynamicGrammarBuilder) {\r\n        this.privDynamicGrammar = dynamicGrammar;\r\n    }\r\n\r\n    /**\r\n     * Gets a section of the speech.context object.\r\n     * @param sectionName Name of the section to get.\r\n     * @return string or Context JSON serializable object that represents the value.\r\n     */\r\n    public getSection(sectionName: string): string | Context {\r\n        return (this.privContext[sectionName] || {}) as string | Context;\r\n    }\r\n\r\n    /**\r\n     * Adds a section to the speech.context object.\r\n     * @param sectionName Name of the section to add.\r\n     * @param value JSON serializable object that represents the value.\r\n     */\r\n    public setSection(sectionName: string, value: string | Context): void {\r\n        this.privContext[sectionName] = value;\r\n    }\r\n\r\n    /**\r\n     * @Internal\r\n     * This is only used by pronunciation assessment config.\r\n     * Do not use externally, object returned will change without warning or notice.\r\n     */\r\n    public setPronunciationAssessmentParams(params: string,\r\n        contentAssessmentTopic: string,\r\n        isSpeakerDiarizationEnabled: boolean = false): void {\r\n        if (this.privContext.phraseDetection === undefined) {\r\n            this.privContext.phraseDetection = {\r\n                enrichment: {\r\n                    pronunciationAssessment: {}\r\n                }\r\n            };\r\n        }\r\n        if (this.privContext.phraseDetection.enrichment === undefined) {\r\n            this.privContext.phraseDetection.enrichment = {\r\n                pronunciationAssessment: {}\r\n            };\r\n        }\r\n        this.privContext.phraseDetection.enrichment.pronunciationAssessment = JSON.parse(params) as Context;\r\n        if (isSpeakerDiarizationEnabled) {\r\n            this.privContext.phraseDetection.mode = \"Conversation\";\r\n        }\r\n        this.setWordLevelTimings();\r\n        this.privContext.phraseOutput.detailed.options.push(\"PronunciationAssessment\");\r\n        if (this.privContext.phraseOutput.detailed.options.indexOf(\"SNR\") === -1) {\r\n            this.privContext.phraseOutput.detailed.options.push(\"SNR\");\r\n        }\r\n        if (!!contentAssessmentTopic) {\r\n            this.privContext.phraseDetection.enrichment.contentAssessment = {\r\n                topic: contentAssessmentTopic\r\n            };\r\n            this.privContext.phraseOutput.detailed.options.push(\"ContentAssessment\");\r\n        }\r\n    }\r\n\r\n    public setDetailedOutputFormat(): void {\r\n        if (this.privContext.phraseOutput === undefined) {\r\n            this.privContext.phraseOutput = {\r\n                detailed: {\r\n                    options: []\r\n                },\r\n                format: {}\r\n            };\r\n        }\r\n        if (this.privContext.phraseOutput.detailed === undefined) {\r\n            this.privContext.phraseOutput.detailed = {\r\n                options: []\r\n            };\r\n        }\r\n        this.privContext.phraseOutput.format = \"Detailed\";\r\n    }\r\n\r\n    public setWordLevelTimings(): void {\r\n        if (this.privContext.phraseOutput === undefined) {\r\n            this.privContext.phraseOutput = {\r\n                detailed: {\r\n                    options: []\r\n                },\r\n                format: {}\r\n            };\r\n        }\r\n        if (this.privContext.phraseOutput.detailed === undefined) {\r\n            this.privContext.phraseOutput.detailed = {\r\n                options: []\r\n            };\r\n        }\r\n        this.privContext.phraseOutput.format = \"Detailed\";\r\n        if (this.privContext.phraseOutput.detailed.options.indexOf(\"WordTimings\") === -1) {\r\n            this.privContext.phraseOutput.detailed.options.push(\"WordTimings\");\r\n        }\r\n    }\r\n\r\n    public setSpeakerDiarizationAudioOffsetMs(audioOffsetMs: number): void {\r\n        this.privContext.phraseDetection.speakerDiarization.audioOffsetMs = audioOffsetMs;\r\n    }\r\n\r\n    public toJSON(): string {\r\n\r\n        const dgi: IDynamicGrammar = this.privDynamicGrammar.generateGrammarObject();\r\n        this.setSection(\"dgi\", dgi);\r\n\r\n        const ret: string = JSON.stringify(this.privContext);\r\n        return ret;\r\n    }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}